!function(){angular.module("kiboRtc.config",[]).value("kiboRtc.config",{debug:!0}),angular.module("kiboRtc.directives",[]),angular.module("kiboRtc.filters",[]),angular.module("kiboRtc.services",[]),angular.module("kiboRtc",["kiboRtc.config","kiboRtc.directives","kiboRtc.filters","kiboRtc.services"])}(),angular.module("kiboRtc.services").factory("FileTransfer",function(e,n,t,o,a,r){function i(e){e.candidate&&r.sendMessageForDataChannel({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate})}function c(e){g.setLocalDescription(e),r.sendMessageForDataChannel(e)}function d(e){console.log("createOffer() error: ",e)}function s(n){R=n.data,e.$broadcast("dataChannelMessageReceived")}function u(){m.readyState}function l(e){m=e.channel,m.onmessage=s,m.onopen=f,m.onclose=f}function f(){m.readyState}var m,g,R,p=!1,S=!1;return{createPeerConnection:function(e){try{g=new RTCPeerConnection(n,{optional:[]}),g.onicecandidate=i;try{try{m=g.createDataChannel("sendDataChannel",{reliable:!0})}catch(t){console.log("UNRELIABLE DATA CHANNEL"),m=g.createDataChannel("sendDataChannel",{reliable:!1})}m.onmessage=s,trace("Created send data channel")}catch(t){return e(t),trace("createDataChannel() failed with exception: "+t.message),void 0}m.onopen=u,m.onclose=u,g.ondatachannel=l,e(null)}catch(t){e(t),console.log("Failed to create PeerConnection, exception: "+t.message)}},sendData:function(e){m.send(e)},createAndSendOffer:function(){g.createOffer(c,d)},createAndSendAnswer:function(){g.createAnswer(c,function(e){console.log(e)},o)},setRemoteDescription:function(e){g.setRemoteDescription(new RTCSessionDescription(e))},addIceCandidate:function(e){var n=new RTCIceCandidate({sdpMLineIndex:e.label,candidate:e.candidate});g.addIceCandidate(n)},endConnection:function(){S=!1,p=!1;try{g.close()}catch(e){}},getMessage:function(){return R},setInitiator:function(e){p=e},getInitiator:function(){return p},setIsStarted:function(e){S=e},getIsStarted:function(){return S},sanitize:function(e){return e=e.toString(),e.replace(/[\<\>"'\/]/g,function(e){var n={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return n[e]})},bootAlert:function(e){alert(e),console.log("Boot_alert: ",e)},FSerrorHandler:function(e){var n="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:n="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:n="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:n="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:n="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:n="INVALID_STATE_ERR";break;default:n="Unknown Error"}console.error("Error: "+n)},getReadableFileSizeString:function(e){var n=-1,t=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do e/=1024,n++;while(e>1024);return Math.max(e,.1).toFixed(1)+t[n]},_arrayBufferToBase64:function(e){for(var n="",t=new Uint8Array(e),o=t.byteLength,a=0;o>a;a++)n+=String.fromCharCode(t[a]);return window.btoa(n)},getChunkSize:function(){return 16e3}}}),angular.module("kiboRtc.services").factory("RTCConference",function(e,n,t,o,a,r){function i(e){e.candidate&&r.sendMessage({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate})}function c(e){O.setLocalDescription(e),r.sendMessage(e)}function d(e){console.log("createOffer() error: ",e)}function s(e){remoteStream?(L.src=URL.createObjectURL(e.stream),C=e.stream,screenShared=!0):(remoteVideo.src=URL.createObjectURL(e.stream),remoteStream=e.stream)}function u(e){console.log(e),"undefined"!=typeof C?(C.stop(),C=null,screenShared=!1):(C.stop(),remoteStream.stop(),C=null,remoteStream=null)}function l(n){message=n.data,e.$broadcast("dataChannelMessageReceived")}function f(){k.readyState}function m(e){k=e.channel,k.onmessage=l,k.onopen=g,k.onclose=g}function g(){k.readyState}var R,p,S,C,h,b,I,v,L,D,y,A=0,E=4,M=!1,w=!1,k=new Array(E),O=new Array(E),U=!1;return{initialize:function(e,n,t,o,a,r,i){h=e,b=n,I=t,v=o,L=a,D=r,y=i},createPeerConnection:function(){try{O[A]=new RTCPeerConnection(n,{optional:[]}),O[A].onicecandidate=i,O[A].onaddstream=s,O[A].onremovestream=u;try{try{k[A]=O[A].createDataChannel("sendDataChannel",{reliable:!0})}catch(e){console.log("UNRELIABLE DATA CHANNEL"),k[A]=O[A].createDataChannel("sendDataChannel",{reliable:!1})}k[A].onmessage=l,trace("Created send data channel")}catch(e){alert("Failed to create data channel. You need Chrome M25 or later with RtpDataChannel enabled : "+e.message),trace("createDataChannel() failed with exception: "+e.message)}k[A].onopen=f,k[A].onclose=f,O[A].ondatachannel=m,O.addStream(p)}catch(e){return console.log("Failed to create PeerConnection, exception: "+e.message),alert("Cannot create RTCPeerConnection object."),void 0}},createAndSendOffer:function(){O[A].createOffer(c,d)},createAndSendAnswer:function(){O[A].createAnswer(c,function(e){console.log(e)},o)},setRemoteDescription:function(e){O.setRemoteDescription(new RTCSessionDescription(e))},addIceCandidate:function(e){var n=new RTCIceCandidate({sdpMLineIndex:e.label,candidate:e.candidate});O.addIceCandidate(n)},captureUserMedia:function(e){getUserMedia(a,function(n){p=n,localVideo.src=URL.createObjectURL(n),e(null)},function(n){e(n)})},endConnection:function(){w=!1,M=!1,console.log(p),p&&p.stop(),S&&S.stop(),remoteStream&&(remoteStream.stop(),remoteVideo.src=null,remoteStream=null),C&&(C.stop(),L.src=null,C=null),console.log(p);try{O.close()}catch(e){}},initializeSignalling:function(e,n,t){r.initialize(e,n,t)},hideScreen:function(){S.stop(),O.removeStream(S)},addStreamForScreen:function(e){S=e,localVideoScreen.src=URL.createObjectURL(e),O.addStream(e)},getLocalStream:function(){return p},getScreenShared:function(){return screenShared},setInitiator:function(e){M=e},getInitiator:function(){return M},setIsStarted:function(e){w=e},getIsStarted:function(){return w},increasePCIndex:function(){A++},getPcIndex:function(){return A},setIsChannelReady:function(e){R=e},getIsChannelReady:function(){return R},setIJoinLate:function(e){U=e},getIJoinLate:function(){return U},stopLocalStream:function(){p.stop()}}}),angular.module("kiboRtc.services").factory("pc_config",function(){return{iceServers:[{url:"turn:cloudkibo@162.243.217.34:3478?transport=udp",username:"cloudkibo",credential:"cloudkibo"},{url:"stun:stun.l.google.com:19302",username:null,credential:null},{url:"stun:stun.anyfirewall.com:3478",username:null,credential:null},{url:"turn:turn.bistri.com:80?transport=udp",username:"homeo",credential:"homeo"},{url:"turn:turn.bistri.com:80?transport=tcp",username:"homeo",credential:"homeo"},{url:"turn:turn.anyfirewall.com:443?transport=tcp",username:"webrtc",credential:"webrtc"}]}}).factory("pc_constraints",function(){return{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!0}]}}).factory("sdpConstraints",function(){return{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}}).factory("video_constraints",function(){return{video:!0,audio:!1}}).factory("audio_constraints",function(){return{video:!1,audio:!0}}),angular.module("kiboRtc.services").factory("ScreenShare",function(e,n){function t(e){if("PermissionDeniedError"==e){if(r="PermissionDeniedError",a)return a("PermissionDeniedError");throw new Error("PermissionDeniedError")}"kiboconnection-extension-loaded"==e&&(r="desktop"),e.sourceId&&(i=e.sourceId,a&&a(e.sourceId))}var o,a,r,i,c={mandatory:{chromeMediaSource:r,maxWidth:1920,maxHeight:1080,minAspectRatio:1.77},optional:[]},d={audio:!1,video:c};return{initialize:function(){o=!!navigator.webkitGetUserMedia,r="screen",window.addEventListener("message",function(e){e.origin==window.location.origin&&t(e.data)})},getSourceId:function(e){if(!e)throw'"callback" parameter is mandatory.';a=e,n.postMessage("get-sourceId","*")},isChromeExtensionAvailable:function(e){e&&("desktop"==r&&e(!0),n.postMessage("are-you-there","*"),setTimeout(function(){"screen"==r?e(!1):(e(!0),c.mandatory.chromeMediaSource="desktop")},2e3))},screen_constraints:function(){return c},session:function(){return d},getChromeMediaSource:function(){return r},getSourceIdValue:function(){return i},setSourceIdInConstraints:function(){c.mandatory.chromeMediaSourceId=i,d.video=c}}}),angular.module("kiboRtc.services").factory("Signalling",function(e,n){var t,o,a;return{initialize:function(e,n,r){t=e,o=n,a=r},sendMessage:function(e){e={msg:e},e.room=a,e.to=t,e.username=o,n.emit("message",e)},sendMessageForDataChannel:function(e){e={msg:e},e.room=a,e.to=t,e.from=o,n.emit("messagefordatachannel",e)},sendMessageForMeeting:function(e){e={msg:e},e.room=a,e.username=o,n.emit("messageformeeting",e)},destroy:function(){t=null,o=null,a=null}}}),angular.module("kiboRtc.services").factory("WebRTC",function(e,n,t,o,a,r,i){function c(e){e.candidate&&i.sendMessage({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate})}function d(e){p.setLocalDescription(e),i.sendMessage(e)}function s(e){console.log("createOffer() error: ",e)}function u(n){n.stream.getAudioTracks().length&&(b.src=URL.createObjectURL(n.stream),E=n.stream),n.stream.getVideoTracks().length&&(A?(I.src=URL.createObjectURL(n.stream),M=n.stream,e.$broadcast("screenShared")):(h.src=URL.createObjectURL(n.stream),A=n.stream))}function l(n){console.log(n),"undefined"!=typeof M?(M.stop(),M=null,e.$broadcast("screenRemoved")):(M.stop(),A.stop(),M=null,A=null)}function f(e,n,t){getUserMedia(e,function(e){n==w?(g=e,y=!0):n==k&&(m=e,S.src=URL.createObjectURL(e),D=!0),t(null)},function(e){t(e)})}var m,g,R,p,S,C,h,b,I,v=!1,L=!1,D=!1,y=!1,A=null,E=null,M=null,w="audio",k="video";return{initialize:function(e,n,t,o,a){S=e,C=n,h=t,b=o,I=a},createPeerConnection:function(){p=new RTCPeerConnection(n,{optional:[]}),p.onicecandidate=c,p.onaddstream=u,p.onremovestream=l,p.addStream(g),m&&p.addStream(m)},createAndSendOffer:function(){p.createOffer(d,s)},createAndSendAnswer:function(){p.createAnswer(d,function(e){console.log(e)},o)},setRemoteDescription:function(e){p.setRemoteDescription(new RTCSessionDescription(e))},addIceCandidate:function(e){var n=new RTCIceCandidate({sdpMLineIndex:e.label,candidate:e.candidate});p.addIceCandidate(n)},toggleVideo:function(n){D?(m.stop(),p.removeStream(m),p.createOffer(d,s),S.src=null,D=!1,e.$broadcast("localVideoRemoved"),n(null)):f(a,k,function(t){return t?n(t):(p.addStream(m),p.createOffer(d,s),S.src=URL.createObjectURL(m),D=!0,e.$broadcast("localVideoAdded"),n(null),void 0)})},toggleAudio:function(n){y?(g.stop(),p.removeStream(g),p.createOffer(d,s),y=!1,e.$broadcast("localAudioRemoved"),n(null)):f(r,w,function(t){return t?n(t):(p.addStream(g),p.createOffer(d,s),y=!0,e.$broadcast("localAudioAdded"),n(null),void 0)})},captureUserMedia:function(e,n){var t;if(e==w)t=r;else{if(e!=k)return n('Invalid stream type. Must be "audio" or "video"');t=a}f(t,e,n)},endConnection:function(){L=!1,v=!1,m&&m.stop(),g&&g.stop(),R&&R.stop(),A&&(A.stop(),h.src=null,A=null),E&&(E.stop(),b.src=null,E=null),M&&(M.stop(),I.src=null,M=null);try{p.close()}catch(e){}},initializeSignalling:function(e,n,t){i.initialize(e,n,t)},hideScreen:function(){R.stop(),p.removeStream(R)},addStreamForScreen:function(e){R=e,C.src=URL.createObjectURL(e),p.addStream(e)},getLocalAudioStream:function(){return g},setInitiator:function(e){v=e},getInitiator:function(){return v},setIsStarted:function(e){L=e},getIsStarted:function(){return L},isLocalVideoShared:function(){return D},isLocalAudioShared:function(){return y}}});